<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Page</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            
        }
        a{
            text-decoration: none;
            color: white;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        form {
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            margin-right: 10px;
        }

        input {
            padding: 5px;
            margin-right: 10px;
        }

        button {
            padding: 5px 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        #productsList {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .product-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            padding: 15px;
            margin: 10px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s;
            text-align: center;
        }

        .product-container:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        h3 {
            color: #333;
            margin-bottom: 10px;
        }

        p {
            margin: 5px 0;
        }

        img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }

        button.update-btn,
        button.delete-btn {
            margin-top: 10px;
            padding: 8px;
            width: 100%;
            background-color: #28a745;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button.delete-btn {
            background-color: #dc3545;
            margin-left: 5px;
        }

        button.update-btn:hover,
        button.delete-btn:hover {
            background-color: #218838;
        }
    </style>
</head>

<body>
    <h1>Product Management</h1>

    <!-- Form to create a product -->
    <form id="createProductForm">
        

        <button type="submit"><a href="addProduct.html">Create Product</a></button>
    </form>

    <!-- Display all products -->
    <div id="productsList"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Fetch products data from the API
            fetch('http://localhost:5454/api/admin/products/all')
                .then(response => response.json())
                .then(data => {
                    // Process the data and display products
                    displayProducts(data);
                })
                .catch(error => {
                    console.error('Error fetching products:', error.message);
                    alert('Error fetching products. Please try again.');
                });

            function displayProducts(products) {
                const productsList = document.getElementById('productsList');

                products.forEach(product => {
                    // Create HTML elements for each product
                    const productContainer = document.createElement('div');
                    productContainer.classList.add('product-container');

                    const title = document.createElement('h3');
                    title.textContent = product.title;

                    // Display image if available
                    if (product.imageUrl) {
                        const img = document.createElement('img');
                        img.src = product.imageUrl;
                        productContainer.appendChild(img);
                    }

                    const description = document.createElement('p');
                    description.textContent = product.description;

                    const price = document.createElement('p');
                    price.textContent = 'Price: ' + product.price;

                    const discountedPrice = document.createElement('p');
                    discountedPrice.textContent = 'Discounted Price: ' + product.discountedPrice;

                    const discountedPresent = document.createElement('p');
                    discountedPresent.textContent = 'Discount Percentage: ' + product.discountedPresent + '%';

                    const quantity = document.createElement('p');
                    quantity.textContent = 'Quantity: ' + product.quantity;

                    const brand = document.createElement('p');
                    brand.textContent = 'Brand: ' + product.brand;

                    // Add update and delete buttons
                    const updateButton = document.createElement('button');
                    updateButton.textContent = 'Update';
                    updateButton.classList.add('update-btn');
                    updateButton.addEventListener('click', () => fetchAndUpdateProduct(product.id));

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.classList.add('delete-btn');
                    deleteButton.addEventListener('click', () => confirmDelete(product.id));


                    // Append elements to the product container
                    productContainer.appendChild(title);
                    productContainer.appendChild(description);
                    productContainer.appendChild(price);
                    productContainer.appendChild(discountedPrice);
                    productContainer.appendChild(discountedPresent);
                    productContainer.appendChild(quantity);
                    productContainer.appendChild(brand);
                    productContainer.appendChild(updateButton);
                    productContainer.appendChild(deleteButton);

                    // Append the product container to the products list
                    productsList.appendChild(productContainer);
                });
            }

            function fetchAndUpdateProduct(productId) {
                // Fetch product details using the API
                fetch(`http://localhost:5454/api/products/id/${productId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Error fetching product details');
                        }
                        return response.json();
                    })
                    .then(productDetails => {
                        // Fill the details in the update form
                        fillUpdateForm(productDetails);
                    })
                    .catch(error => {
                        console.error('Error fetching product details:', error.message);
                        alert('Error fetching product details. Please try again.');
                    });
            }

            function fillUpdateForm(productDetails) {
                // Redirect to the update.html page and pass the product details as query parameters
                const queryString = Object.keys(productDetails)
                    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(productDetails[key])}`)
                    .join('&');

                window.location.href = `update.html?${queryString}`;
            }

            function confirmDelete(productId) {
                const isConfirmed = window.confirm('Are you sure you want to delete this product?');
                if (isConfirmed) {
                    deleteProduct(productId);
                }
            }

            function deleteProduct(productId) {
                // Call the API to delete the product
                fetch(`http://localhost:5454/api/admin/products/${productId}/delete`, {
                    method: 'DELETE',
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error deleting product');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Product deleted successfully:', data);
                    // Refresh the products list or update the UI as needed
                    // For example, you can fetch the products again and display the updated list
                    window.location.href = "products.html";
                })
                .catch(error => {
                    console.error('Error deleting product:', error.message);
                    alert('Error deleting product. Please try again.');
                });
            }
        });
    </script>
</body>

</html>
